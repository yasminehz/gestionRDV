{{ form_start(form, {'attr': {'id': 'indispo-form'}}) }}
    <div id="indispo-form-error" style="color:red;margin-bottom:8px;display:none;"></div>
    <div class="form-group">
        {{ form_label(form.debut) }}
        {{ form_widget(form.debut, {'attr': {'class': 'form-control js-datetime', 'data-existing': existing is defined ? existing|json_encode : ''}}) }}
        {{ form_errors(form.debut) }}
    </div>
    <div class="form-group">
        {{ form_label(form.fin) }}
        {{ form_widget(form.fin, {'attr': {'class': 'form-control js-datetime', 'data-existing': existing is defined ? existing|json_encode : ''}}) }}
        {{ form_errors(form.fin) }}
    </div>
    <div class="form-group">
        {{ form_label(form.motif) }}
        {{ form_widget(form.motif, {'attr': {'class': 'form-control'}}) }}
        {{ form_errors(form.motif) }}
    </div>
    <button class="btn btn-primary" id="indispo-submit">Enregistrer</button>
{{ form_end(form) }}

<script>
// Client-side validation: fin must be after debut
(function(){
    var form = document.getElementById('indispo-form');
    if (!form) return;

    function parseLocalDateTime(val){
        if (!val) return null;
        // flatpickr returns 'Y-m-d H:i' for value
        var parts = val.split(' ');
        if (parts.length < 2) return new Date(parts[0]);
        var d = parts[0].split('-');
        var t = parts[1].split(':');
        return new Date(d[0], parseInt(d[1],10)-1, d[2], t[0], t[1]);
    }

    form.addEventListener('submit', function(e){
        var debut = form.querySelector('input[name$="[debut]"]');
        var fin = form.querySelector('input[name$="[fin]"]');
        var err = document.getElementById('indispo-form-error');
        if (!debut || !fin) return;
        var d1 = parseLocalDateTime(debut.value);
        var d2 = parseLocalDateTime(fin.value);
        if (!d1 || !d2) return; // let server validate
        if (d2 <= d1) {
            e.preventDefault();
            err.style.display = 'block';
            err.textContent = 'La date de fin doit être strictement postérieure à la date de début.';
            return false;
        }
        err.style.display = 'none';
    });
})();
</script>
